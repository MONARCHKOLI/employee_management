<!DOCTYPE html>
<html>
  <head>
    <title>EmployeeManagement</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
  </head>
  <script>
    function live_search(value) {
      text = document.getElementById('search').value
      // console.log(text)
      $.ajax({
        type: "GET",
        url: "employees?query=" + this.text,
        data: {'search_keyword' : value},
        dataType: "json",
        success: function(msg){
          // console.log(msg)
          let jsonData = msg.employee
          // document.getElementsByClassName("search_body").style.display = "none";
          let container = document.getElementById("container");

          let html = ''
          jsonData.forEach((employee, index)=> {
            html += `<tr class='tableRows'>
                        <td>${index +1}</td>
                        <td><a href="employees/${employee.name}">${employee.name}</a></td>
                        <td>${employee.address}</td>
                        <td>${employee.date_of_birth}</td>
                        <td>${employee.mobile_number}</td>
                        <td>${employee.years_of_experience}</td>
                        <td ><%= link_to "Edit", "employees/${employee.id}" +"/edit", :class=> "btn btn-info" %>&nbsp;<%= link_to "Destroy","employees/${employee.id}", method: :delete, data: {confirm: "Are you sure?"}, :class=> "btn btn-danger" %></td>
                     </tr>`
        });
        let tableBody = document.getElementById('tableBody');
        if (jsonData.length != 0) {
            tableBody.innerHTML = html;
        }
        else {
            tableBody.innerHTML = "";
            document.getElementById('no_data').innerHTML = `<h3>Nothing to show!!! Use <span><a href="employees/new">"Add Employee"</a</span></h3>`;
        }
          // json = jQuery.parseJSON(msg)
          // $(".table-hover").html(msg);
        }
      });
    }
  </script>
  <body>
  <% if notice || alert%>
    <p class="notice"><%= notice %></p>
    <p class="alert"><%= alert %></p>
  <% end %>
    <%= yield %>
    <style>
        .material-symbols-outlined {
                font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 48
        }
</style>
  </body>
</html>
